---
layout:     post
title:      WebAPIs学习笔记
date:       2021-07-10
author:     PengPengQi
header-img: img/BackGround.png
catalog: true
tags:
    - DOM
    - BOM
    - WebAPIs
    - JavaScript
    - Notes
---
## WebAPIs
主要学习DOM 和BOM。  
API是给程序员提供的一种工具，以便能更轻松的实现想要完成的功能。  
**WebAPI是浏览器**提供的一套操作**浏览器功能**和**页面元素**的**API**(BOM 和 DOM)。  
## DOM
### DOM简介
DOM（文档对象模型），处理可标记语言的编程接口。  
可以改变页面的样式、内容和结构。  
### DOM树
文档：一个页面就是一个文档，DOM中使用`document`表示  
元素：页面中所有的标签都是元素，DOM中使用`element`表示  
节点：网页中所有的内容都是节点（标签、属性、文本、注释等），DOM中使用`node`表示  
### 获取元素
`getElementById(id)`方法  
```html
<body>
  <div id="time">2021-07-10</div>
  <script>
    // 因为文档页面从上往下加载，所以先有标签，script写在下面
    // id是大小写敏感的字符串
    // 返回的是一个元素对象
    var timer = document.getElementById('time'); 
    console.log(timer);        // <div id="time">2021-07-10</div>
    console.log(typeof timer); // object
    // console.dir()打印我们返回的元素对象，更好的查看里面的属性和方法
    console.dir(timer);
  </script>
</body>
```
`getElementsByTagName()`方法，返回带有指定标签名的**对象集合**。    
```js
// 返回的是获取过来元素对象的集合，以伪数组的形式存储的
var lis = document.getElementsByTagName('li');
console.log(lis);
console.log(lis[0]);  // 打印第一个li

// 获取某个特定的id下的li
var nav = document.getElementById('nav');
var Navlis = nav.getElementsByTagName('li');
console.log(Navlis);
```
> 得到的元素对象是动态的

H5新增：  
`getElementsByClassName()`根据类名获得某些元素集合
```js
var boxs = document.getElementsByClassName('box');
console.log(boxs);
```
`querySelector(‘选择器’)`返回指定选择器的**第一个元素对象**  
```js
var firstBox = document.querySelector('.box');
console.log(firstBox);
```
`querySelectorALL(‘选择器’)`返回指定选择器的**所有元素对象集合**  
获取body和html标签：  
- 获取body`document.body`
- 获取html`document.documentElement`

### 事件基础
事件分为三部分：事件源、事件类型、事件处理程序。  
事件源：事件被触发的对象  
事件类型：如何触发，什么事件，比如鼠标点击（onclick）、鼠标经过、还是键盘按下。  
事件处理程序：通过一个函数赋值的方式完成。  
```html
  <button id="btn">唐伯虎</button>
  <script>
    var btn = document.getElementById('btn');
    btn.onclick = function() {
      alert('点秋香!');
    }
  </script>
```
上面实例可[见](/demo/事件三要素.html)
### 操作元素
#### 改变元素内容
`element.innerText`，可见[demo](/demo/修改元素内容.html)  
`element.innerText`与`element.innerHtml`区别：
```html
  <div></div>
  <p></p>
  <script>
    var div = document.querySelector('div');
    var p = document.querySelector('p');
    // 不识别html标签
    div.innerText = '<strong>今天是：</strong> 2021';
    // 识别html标签
    p.innerHTML = '<strong>今天是：</strong> 2021';
    // 这两个属性是可读写的，可以获取元素里面的内容
    // innerText：去除html标签，去除空格和换行
    // innerHTML：起始位置到终止位置的全部内容，包括html标签，保留空格和换行
  </script>
```
可见[demo](/demo/innerText与innerHtml区别.html)
#### 修改元素属性
- 1.innerText、innerHTML改变元素内容
- 2.src、href
- 3.id、alt、title

```html
    <button id="ldh">刘德华</button>
    <button id="zxy">张学友</button> <br>
    <img src="images/ldh.jpg" alt="" title="刘德华">

    <script>
        // 修改元素属性  src
        // 1. 获取元素
        var ldh = document.getElementById('ldh');
        var zxy = document.getElementById('zxy');
        var img = document.querySelector('img');
        // 2. 注册事件  处理程序
        zxy.onclick = function() {
            img.src = 'images/zxy.jpg';
            img.title = '张学友思密达';
        }
        ldh.onclick = function() {
            img.src = 'images/ldh.jpg';
            img.title = '刘德华';
        }
    </script>
```
[分时间问候案例](/demo/分时显示不同图片.html)
#### 修改表单属性
`value`、`disabled`、`type`、`checked`、`selected`
```html
  <button>按钮</button>
  <input type="text" value="我是一台挖掘机">
  <script>
    var btn = document.querySelector('button');
    var input = document.querySelector('input');

    btn.onclick = function() {
      this.disabled = true;
      input.value = '挖掘本领强';
    }
  </script>
```
可见[修改表单属性dmeo](/demo/修改表单属性.html)  
[显示隐藏密码demo](/demo/显示隐藏密码.html)
#### 修改样式属性
修改元素的大小、颜色、位置等样式。  
```html
  <div></div>
  <script>
    var div = document.querySelector('div');
    div.onclick = function() {
      this.style.backgroundColor = 'purple';
      this.style.width = '250px';
    }
  </script>
```
- [修改元素样式](/demo/修改样式属性.html)  
- [精灵图案例](/demo/精灵图案例.html)  
- [显示隐藏文本框内容](/demo/显示隐藏文本框内容.html)  
- [密码验证](/demo/密码验证.html)  
- [背景换肤](/demo/百度换肤.html)  

> 通过style样式操作，修改的是行内样式，css权重比较高
  
使用`className`修改样式，提前写好类的样式，然后修改标签的类。适合样式较多或者功能复杂的情况。  
```js
this.className = 'change';        // 修改样式的类名
this.className = 'font18 change'; // 可以保留之前的样式
```
#### 获取自定义属性
- `element.属性`获取元素自带的属性  
- `element.getAttribute()`获取自定义属性  
  
设置元素属性值：
- `element.属性='值'` 设置元素自带的属性  
- `element.setAttribute('属性名', '属性值')` 设置自定义属性  
  
移除元素属性值：
- `element.removeAttribute()`  
  
> [tab栏切换](/demo/tab栏切换.html)

#### H5自定义属性
- 1.兼容性获取`element.getAttribute('data-index')`;  
- 2.H5新增`element.dataset.index`或者`element.dataset['index']`;

```html
    <div getTime="20" data-index="2" data-list-name="andy"></div>
    <script>
        var div = document.querySelector('div');
        // console.log(div.getTime);
        console.log(div.getAttribute('getTime'));
        div.setAttribute('data-time', 20);
        console.log(div.getAttribute('data-index'));
        console.log(div.getAttribute('data-list-name'));
        // h5新增的获取自定义属性的方法 它只能获取data-开头的
        // dataset 是一个集合里面存放了所有以data开头的自定义属性
        console.log(div.dataset);
        console.log(div.dataset.index);
        console.log(div.dataset['index']);
        // 如果自定义属性里面有多个-链接的单词，我们获取的时候采取 驼峰命名法
        console.log(div.dataset.listName);
        console.log(div.dataset['listName']);
    </script>
```
#### 三中动态创建元素的区别
- `document.write()`：直接将内容写入页面的内容流，但是文档流执行完毕，则它会导致页面**全部重绘**
- `element.innerHTML`：创建多个元素效率更高(不要**拼接字符串**，采取数组形式拼接)，结构稍微复杂
- `document.createElement()`：创建多个元素效率稍低一点点，但是结构更清晰

### 节点操作
利用父子兄节点关系获取元素。  
一般节点至少拥有`nodeType`、`nodeName`、`nodeValue`这三个基本属性。  
- 元素节点：nodeType 为 1  
- 属性节点：nodeType 为 2
- 文本节点：nodeType 为 3（文本节点包含文字、空格、换行等）

实际开发中，主要操作**元素节点**。  
#### 节点层级
最近的父级节点：`parentNode`，如果找不到则返回null。  
子级节点：`parentNode.childNodes` 和`parentNode.children`(实际开发常用)  
第一个节点：`parentNode.firstChild`、`parentNode.firstElementChild`  
最后一个节点：`parentNode.lastChild`、`parentNode.lastElementChild`  
兄弟节点：`element.nextSibling`、`element.previouSibling`、`element.nextElementSibling`、`element.previousElementSibling`  
#### 创建和添加节点
创建节点：`document.createElement('li')`   
添加节点：`node.appendChild(child)`  
```html
    <ul>
        <li>123</li>
    </ul>
    <script>
        // 1. 创建节点元素节点
        var li = document.createElement('li');
        // 2. 添加节点 node.appendChild(child)  node 父级  child 是子级 后面追加元素  类似于数组中的push
        var ul = document.querySelector('ul');
        ul.appendChild(li);

        // 3. 添加节点 node.insertBefore(child, 指定元素);
        var lili = document.createElement('li');
        ul.insertBefore(lili, ul.children[0]);
        // 4. 我们想要页面添加一个新的元素 ： 1. 创建元素 2. 添加元素
    </script>
```
#### 删除节点
`node.removeChild(child)`方法从DOM中删除一个子节点，返回删除的节点。  
- [简易留言板](/demo/简易留言板.html)  
- [动态生成表格](/demo/动态生成表格.html)

#### 复制节点
`node.cloneNode()`若括号为空，或者里面是false，则为**浅拷贝**，只复制标签，不复制里面的内容。若括号里面为true，即复制标签又复制内容，则为**深拷贝**。
### 事件高级
#### 注册事件
注册事件有两种方式:**传统方式**和**方法监听注册方式**。  
传统注册方式: 同一个元素同一个事件只能设置一个处理函数，最后注册的处理函数将会覆盖前面注册的处理函数  
方法监听注册方式: 同一个元素同一个事件可以注册多个监听器, `eventTarget.addEventListener(type, listener[, useCapture])`  
- `type`:事件类型字符串，比如 click 、mouseover ，注意这里不要带 on
- `listener`:事件处理函数，事件发生时，会调用该监听函数
- `useCapture`:可选参数，是一个布尔值，默认是 false。学完 DOM 事件流后，我们再进一步学习

```html
    <button>传统注册事件</button>
    <button>方法监听注册事件</button>
    <script>
        var btns = document.querySelectorAll('button');
        // 1. 传统方式注册事件
        btns[0].onclick = function() {
            alert('hi');
        }
        btns[0].onclick = function() {
                alert('hao a u');
            }
        // 里面的事件类型是字符串 必定加引号 而且不带on
        btns[1].addEventListener('click', function() {
            alert(22);
        })
        // 和上面一样
        // btns[1].addEventListener('click', fn); //fn不需要加小括号
        // function fn() {
        //     alert(22);
        // }
        btns[1].addEventListener('click', function() {
                alert(33);
            })
    </script>
```
#### 删除事件
传统注册方式：`eventTarget.onclick = null`  
方法监听注册方式：`eventTarget.removeEventListener(type, listener[, useCapture]);`
```html
    <div>1</div>
    <div>2</div>
    <script>
        var divs = document.querySelectorAll('div');
        divs[0].onclick = function() {
                alert(11);
        // 1. 传统方式删除事件
                divs[0].onclick = null;
            }
        
        // 2. removeEventListener 删除事件
        divs[1].addEventListener('click', fn) // 里面的fn 不需要调用加小括号

        function fn() {
            alert(22);
            divs[1].removeEventListener('click', fn);
        }
    </script>
```
#### DOM事件流
事件流描述的是从页面中**接收事件的顺序**。主要分为三个阶段：
- 捕获阶段：由DOM最顶层节点开始，逐级向下传播到最具体的元素接收的过程（document --> html --> body --> div）
- 当前目标阶段
- 冒泡阶段：由最具体的元素接收，然后逐级向上传播到DOM最顶层节点的过程（div --> body --> html --> document）
  
注意：
- 1.JS代码只执行捕获或冒泡其中一个阶段
- 2.onclick只能得到冒泡阶段
- 3.`addEventListener(type, listener[, useCapture])`第三个参数如果是 true，表示在事件**捕获阶段**调用事件处理程序;如果是 false(不写默认就是false)，表示在事件**冒泡阶段**调用事件处理程序。
- 4.实际开发中更关注事件冒泡
- 5.有些事件是没有冒泡的，比如：`onblur`、`onfocus`、`onmouseenter`、`onmouseleave`
  
#### 事件对象
简单理解:事件发生后，**跟事件相关的一系列信息数据的集合**都放到这个对象里面，这个对象就是**事件对象event**，它有很多属性和方法。  
```js
eventTarget.onclick = function(event) {} 
eventTarget.addEventListener('click', function(event) {}) 
// 这个 event 就是事件对象，我们还喜欢的写成 e 或者 evt
```
这个 event 是个形参，系统帮我们设定为事件对象，不需要传递实参过去。  
当我们注册事件时， event 对象就会被系统自动创建，并依次传递给事件监听器(事件处理函数)。  
##### 常见属性和方法
`e.target`与`this`的区别：  
- `this`是事件绑定的元素，这个函数的调用者  
- `e.target`是事件触发的元素  
- `e.type`是事件的类型，比如：`click`、`mouseover`，不带`on`
- `e.preventDefault()`，阻止事件跳转

#### 阻止冒泡事件
`e.stopPropagation()`，propagation(传播)。  
#### 事件委托
事件委托也称为事件代理，在jQuery里面称为事件委派。  
**事件委托的原理**：不是每个子节点单独设置事件监听器，而是事件监听器设置在其父节点上，然后利用冒泡原理影响设置每个子节点。  
**事件委托的作用**：提高了性能。 
#### 常用鼠标事件
1.**禁止鼠标右键菜单**。`contextmenu`主要控制应该何时显示上下文菜单，主要用于程序员取消默认的上下文菜单。    
```js
document.addEventListener('contextmenu', function(e) { 
  e.preventDefault();
})
```
2.**禁止鼠标选中**（selectstart 开始选中）  
```js
document.addEventListener('selectstart', function(e) { 
  e.preventDefault();
})
```
3.**鼠标事件对象**：`client`在可视区域的x和y坐标
```js
// 鼠标事件对象 MouseEvent
document.addEventListener('click', function(e) {
    // 1. client 鼠标在可视区的x和y坐标
    console.log(e.clientX);
    console.log(e.clientY);
    console.log('---------------------');

    // 2. page 鼠标在页面文档的x和y坐标
    console.log(e.pageX);
    console.log(e.pageY);
    console.log('---------------------');

    // 3. screen 鼠标在电脑屏幕的x和y坐标
    console.log(e.screenX);
    console.log(e.screenY);
})
```
> [跟随鼠标事件](/demo/跟随鼠标移动.html)

#### 常用键盘事件
- `onkeyup`(键盘弹起)
- `onkeydown`(键盘按下时)
- `keypress`(键盘按下，不能识别功能键，enter、shift等)

> 三个事件执行顺序：down --> press --> up

#### 键盘事件对象
`keyCode`属性可以得到对应键的ASCII码值。  

> 1.`keyup`、`keydown`事件不区分字母大小  
> 2.[按键输入内容](/demo/键盘s实现搜索.html)  
> 3.[放大输入文字案例](/demo/快递单号查询.html)  
