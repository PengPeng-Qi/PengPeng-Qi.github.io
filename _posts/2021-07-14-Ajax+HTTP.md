---
layout:     post
title:      Ajax+HTTP
date:       2021-07-17
author:     PengPengQi
header-img: img/BackGround.png
catalog: true
tags:
    - Ajax
    - HTTP
    - Notes
---
## 前言
以下是我结合前面的知识以及本文的相关内容所写的demo
- [评论列表](/demo/Form+AJAX/评论列表.html)
- [自己封装的AJAX函数](/demo/Form+AJAX/js/PengPengQ.js)

## AJAX介绍
### URL地址
URL地址一般由三部分组成：  
- 1、客户端与服务端之间的**通信协议**
- 2、存有该资源的**服务器名称**
- 3、资源在服务器上**具体的存放位置**
  
### 分析网页的打开过程
- 1、打开浏览器  
- 2、输入要访问的网站地址  
- 3、回车，向服务器发起资源**请求**  
- 4、服务器接收客户端发来的资源请求  
- 5、服务器在内部**处理**这次请求，找到相关资源  
- 6、服务器把找到的资源，**响应**（发送）给客户端  

### 服务器对外提供了那些资源
如果要在网页中请求服务器上的数据资源，则需要用到`XMLHttpRequest`对象。xhr是浏览器提供的js成员，通过它，可以请求服务器上的数据资源。最简单的用法`var xhrObj = new XMLHttpRequest()`  
  
客户端请求服务器时，**请求的方式**有很多种，最常见的两种请求方式分别为`get`、`post`请求。
- `get`：获取服务端资源
- `post`：向服务器提交数据

### 了解Ajax
Ajax：异步JavaScript和XML，在网页中利用`XMLHttpRequest`对象和**服务器**进行**数据交互**的方式，就是Ajax。  

### jQuery中的Ajax
jQuery对`XMLHttpRequest`进行了封装，提供了一系列Ajax相关的函数，极大地降低了Ajax的使用难度。
- `$.get()`
- `$.post()`
- `$.ajax()`

#### $.get()
用来发起`get`请求，从而将服务器上的资源请求到客户端来进行使用。  
语法：`$.get(url, [data], [callback])`
- `url`：string，必选，要请求的资源地址
- `data`：object，请求资源时携带的参数
- `callback`：function，请求成功时的回调函数

```js
$(function () {
  $('#btnGETINFO').on('click', function () {
    $.get('http://www.liulongbin.top:3006/api/getbooks', { 
      id: 1 
    }, function (res) {
      console.log(res)
    })
  })
})
```

#### $.post()
发起post请求，从而向服务器提交数据。  
语法：`$.post(url, [data], [callback])`
- `url`：string，必选，提交数据的地址
- `data`：object，要提交的数据
- `callback`：function，数据提交成功时的回调函数

```js
$(function () {
  $('#btnPOST').on('click', function () {
    $.post('http://www.liulongbin.top:3006/api/addbook', { 
      bookname: '水浒传', 
      author: '施耐庵', 
      publisher: '天津图书出版社' 
    }, function (res) {
      console.log(res)
    })
  })
})
```
#### $.ajax()
`$.ajax()`是一个功能比较综合的函数，它允许我们对 Ajax 请求进行更详细的配置。
  
```js
$.ajax({
   type: '', // 请求的方式，例如 GET 或 POST
   url: '',  // 请求的 URL 地址
   data: { },// 这次请求要携带的数据
   success: function(res) { } // 请求成功之后的回调函数
})
```
使用`$.ajax()`发起`GET`请求时，只需要将`type`属性的值设置为'GET'即可：
```js
$.ajax({
  type: 'GET', // 请求的方式
  url: 'http://www.liulongbin.top:3006/api/getbooks',  // 请求的 URL 地址
  data: { id: 1 },// 这次请求要携带的数据
  success: function(res) { // 请求成功之后的回调函数
      console.log(res)
  }
})
```
使用`$.ajax()`发起`POST`请求时，只需要将`type`属性的值设置为'POST'即可：
```js
$.ajax({
   type: 'POST', // 请求的方式
   url: 'http://www.liulongbin.top:3006/api/addbook',  // 请求的 URL 地址
   data: { // 要提交给服务器的数据
      bookname: '水浒传',
      author: '施耐庵',
      publisher: '上海图书出版社'
    },
   success: function(res) { // 请求成功之后的回调函数
       console.log(res)
   }
})
```
### 接口
使用Ajax请求数据时，**被请求的URL地址**，就叫做**数据接口**（简称**接口**）。同时，每个接口必须有**请求方式**。  
## 表单与模版引擎
### Form表单的基本使用
表单在网页中主要负责**数据采集**功能。  
  
表单的三个基本部分组成：
- 表单标签`<form>`
- 表单域：包含文本框、密码框、单选框等
- 表单按钮`<button>`

`<form>`标签的属性则是用来规定如何把采集到的数据发送到服务器。
- `action`：URL地址，规定提交表单时，**向何处发送表单数据**
- `method`：规定以何种方式把表单数据提交到URL地址中
  - `GET`：适合提交少量、简单的数据
  - `POST`：大量、复杂或者**文件上传**的数据，常用于登陆、注册、添加数据等表单操作
- `enctype`：规定在发送表单数据之前如何对其进行编码
  - `application/x-www-form-urlencoded`：默认，在发送前编码所有字符
  - `multipart/form-data`：不对字符编码，涉及文件上传时，必须使用该值
- `target`：规定在何处打开URL
  - `_blank`：在新窗口打开
  - `_self`：默认值，在相同的窗口打开

**表单的同步提交**：通过点击submit按钮，触发表单提交的操作，从而使页面跳转到action URL的行为，叫做表单的同步提交。  
缺点：
- 1、同步提交后，整个页面发生跳转，跳转到action URL所指向的地址
- 2、同步提交后，页面之前的状态和数据会发生丢失

> 解决方案：表单负责采集数据，AJAX负责将数据提交给服务器

### 通过AJAX提交表单数据
#### 监听表单提交事件
在jQuery中，有两种方式，可以实现监听表单的提交时间：
```js
$('#form1').submit(function() {
  alert('我监听到了表单的提交事件')
})

$('#form1').on('submit', function() {
  alert('我监听到了表单的提交事件')
})
```
#### 阻止表单默认提交行为
当监听到表单的提交事件以后，可以调用事件对象的`event.preventDefault()`函数，来阻止表单的提交和页面的跳转
```js
// 阻止表单默认提交行为方式一
$('#form1').submit(function(e){
  e.preventDefault();
  console.log('阻止了表单的默认提交行为')
})

// 阻止表单默认提交行为方式二
$('#form1').on('submit', function(e){
  e.preventDefault();
  console.log('我也阻止了事件提交');
})
```
#### 快速获得表单中的数据
为了简化表单中数据的获取操作，jQuery中提供了`serialize()`函数，语法如下：
```js
$(seletor).serialize();
```
`serialize()`函数的好处是可以**一次性获取表单中的所有数据**。  
```js
$('#form1').on('submit', function (e) {
  e.preventDefault();
  var data = $('#form1').serialize();
  console.log(data); 
})
```
> 在使用`serialize()`函数快速获取表单数据时，**必须为每个表单元素添加name属性**

## AJAX加强
### XMLHttpRequest的基本使用
`XMLHttpRequest`是浏览器提供的Javascript对象，通过它，可以**请求服务器上的数据资源**  
  
**使用xhr发起GET请求**：
- 1、创建`xhr`对象
- 2、调用`xhr.open()`函数
- 3、调用`xhr.send()`函数
- 4、监听`xhr.onreadstatechange`事件  

```js
var xhr = new XMLHttpRequest();

xhr.open('GET', 'http://www.liulongbin.top:3006/api/getbooks');
xhr.send();

xhr.onreadystatechange = function() {
  if (xhr.readyState == 4 && xhr.status == 200) {
    console.log(xhr.response);
  }
}
```
了解xhr对象的`readState`属性：`readState`属性用来表示当前Ajax请求所处的状态。  
- 0：`XMLHttpRequest`对象被创建
- 1：`open()`方法被调用
- 2：`send()`方法被调用
- 3：数据接收中
- 4：Ajax请求完成，意味着数据传输已经彻底完成或失败

**使用xhr发送带参数的GET请求**：
```js
// 在调用xhr.open()期间，为URL地址指定参数
xhr.open('GET', 'http://www.liulongbin.top:3006/api/getbooks?id=1&bookname=西游记')
```
无论使用`$.ajax()`，还是使用`$.get()`，又或者直接使用`xhr` 对象发起 `GET`请求，当需要携带参数的时候，本质上，都是直接将参数以查询字符串的形式，追加到 URL 地址的后面，发送到服务器的。  
```js
$.get('url', {name: 'zs', age: 20}, function() {})
// 等价于
$.get('url?name=zs&age=20', function() {})

$.ajax({ method: 'GET', url: 'url', data: {name: 'zs', age: 20}, success: function() {} })
// 等价于
$.ajax({ method: 'GET', url: 'url?name=zs&age=20', success: function() {} })

```
**URL编码**：如果 URL 中需要包含中文这样的字符，则必须对中文字符进行编码（转义）。  
**URL编码的原则**：使用安全的字符（没有特殊用途或者特殊意义的可打印字符）去表示那些不安全的字符。  
URL编码原则的通俗理解：**使用英文字符去表示非英文字符**。  
```js
console.log(encodeURI('碰碰漆'));    // encodeURL()编码的函数
// %E7%A2%B0%E7%A2%B0%E6%BC%86
console.log(decodeURI('%E7%A2%B0'));// decodeURL()解码的函数
// 碰 
```
**使用xhr发起POST请求**：
- 1、创建`xhr`对象
- 2、调用`xhr.open()`函数
- 3、设置`Content-Type属性`(固定写法)
- 4、调用`xhr.send()`函数，同时指定要发送的数据
- 5、监听`xhr.onreadstatechange`事件  

```js
// - 1、创建`xhr`对象
var xhr = new XMLHttpRequest();

// - 2、调用`xhr.open()`函数
xhr.open('POST', 'http://www.liulongbin.top:3006/api/addbook');

// - 3、设置`Content-Type属性`(固定写法)
xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

// - 4、调用`xhr.send()`函数，同时指定要发送的数据
xhr.send('bookname=水浒传&author=施耐庵&publisher=四川出版社')

// - 5、监听`xhr.onreadstatechange`事件  
xhr.onreadystatechange = function() {
  if (xhr.readyState == 4 && xhr.status == 200) {
    console.log(xhr.responseText);
  }
}
```
### 数据交换格式
数据交换格式，就是**服务器端**与**客户端**之间进行**数据传输与交换的格式**。
#### XML
XML：可拓展标记语言。XML与HTML的区别：
- HTML被设计来描述网页上的**内容**
- XML被设计用来**传输和存储**数据

#### JSON
**JSON是Javascript对象和数组的字符串表示方法**，使用文本表示一个JS对象或数组的信息，因此，**JOSN的本质是字符串**。  
JSON包含**对象和数组**两种结构。  
##### 对象结构
对象结构在JSON中表示`{}`括起来的内容，数据结构为{key:value, key:value, ...}的键值对结构。key必须使用英文的**双引号包裹的字符串**，value的数据类型可以是**数字、字符串、布尔值、null、数组、对象**6种类型。  
```js
// 对象结构
{
  "name": "zs",
  "age": 20,
  "gender": "男",
  "address": null,
  "hobby": ["吃饭", "睡觉", "打豆豆"]
}
```
##### 数组结构
在JSON中表示`[]`括起来的内容，数据结构为`["java", "Javascript", 30, true...]`。数组中数据的类型可以是**数字，字符串，布尔值、null、数组、对象**6种类型。
```js
[ "java", "python", "php" ]
[ 100, 200, 300.5 ]
[ true, false, null ]
[ { "name": "zs", "age": 20}, { "name": "ls", "age": 30} ]
[ [ "苹果", "榴莲", "椰子" ], [ 4, 50, 5 ] ]
```
**JSON的作用**：在计算机与网络之间存储和传输数据。  
**JSOn的本质**：用字符串来表示Javascript对象数据或数组数据。  
##### JSON和JS对象的关系
JSON是JS对象的字符串表示法，它使用文本表示一个JS对象的信息，本质是一个字符串。例如：
```js
//这是一个对象
var obj = {a: 'Hello', b: 'World'}

//这是一个 JSON 字符串，本质是一个字符串
var json = '{"a": "Hello", "b": "World"}' 
```
##### JSON和JS对象的互转
要实现从 JSON 字符串转换为 JS 对象，使用 `JSON.parse()` 方法：
```js
var obj = JSON.parse('{"a": "Hello", "b": "World"}')
//结果是 {a: 'Hello', b: 'World'}
```
要实现从 JS 对象转换为 JSON 字符串，使用 `JSON.stringify()` 方法：
```js
var json = JSON.stringify({a: 'Hello', b: 'World'})
//结果是 '{"a": "Hello", "b": "World"}'
```
##### 序列化与反序列化
把数据对象转换为字符串的过程，叫做**序列化**。把字符串转换为数据对象的过程叫做**反序列化**。
### 封装自己的Ajax函数
可见自己封装的AJAX函数[PengPengQ](/demo/Form+AJAX/js/PengPengQ.js)  
### XMLHttpRequest Level2的新特性
### jQuery高级用法
### axios